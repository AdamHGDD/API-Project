<!DOCTYPE html>
<html lang="en">
<head>
  <title>Heroclix Team Builder Examine Teams</title>
  <link rel="stylesheet" type="text/css" href="/style.css">
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
  <script type="text/babel">
    // Add new clix to the page
    const loadClix = () => {
      //
    };

    // Focus the page on a clicked team
    const focusOnTeam = () => {
      //
    };

    // Add new team item to the page
    const loadTeam = (team) => {
      //
      console.log("new team added to page");
      console.dir(team);
    };

    // Process requests and put information on the page
    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content');

      // This UI should never allow you to get any response other than 200
      // Because the GET request will always be successful

      if(xhr.response && xhr.getResponseHeader('Content-Type') === 'application/json') {
        const obj = JSON.parse(xhr.response);
        console.log("next print is the obj");
        console.dir(obj);

        if(obj.teams) {
          // Empty out teams section and clix section

          // Hide clix section and unhide team section

          // Load teams
          for(let team in obj.teams)
          {
            // New team page element
            loadTeam((obj.teams)[team]);
          }
        }
      }
    };

    const getRequest = (e, url) => {
      // Set up the type of request
      const xhr = new XMLHttpRequest();
      xhr.open("GET", url);

      // Set up headers for the request
      xhr.setRequestHeader('Accept', 'application/json');

      // Get handleResponse
      xhr.onload = () => handleResponse(xhr, true);

      // Send data
      xhr.send();
      if(e) {e.preventDefault();}

      // Avoid bubbling
      return false;
    };


    // Send a get request for user information (or send a head request)
    const requestTeams = (e) => {
      // Information for GET requests
      let url = "/getTeams";
      // Add query params
      const search = document.querySelector("#searchField");
      url += `?search=${search.value}`;

      // Make get request
      getRequest(e, url);
    }

    // Attach form script information to the webpage
    const init = () => {
      console.log("init");

      // Get forms
      const search = document.querySelector("#searchField");

      // Assign events to those variables
      search.addEventListener('change', requestTeams);

      // Call to start
      requestTeams(null);
    };

    window.onload = init;
  </script>
</head>
<body>
  <section id="top">
    <section id="searchTop">
      <form id="nameForm">
        <label for="search">Search: </label>
        <input id="searchField" type="text" name="search"/>
      </form>
    </section>
    <section id="teamTop">
      <h2 class="teamName">Team Name: Just Batman</h2>
      <h3 class="teamCost">Clix: 1</h3>
      <h3 class="teamCost">Team Cost: 125</h3>
      <input type="submit" value="Back"/>
    </section>
  </section>
  <section id="content">
    <section id="teams">
      <div class="teamEntry">
        <h2 class="teamName">Team Name: Just Batman</h2>
        <h3 class="teamCost">Team Cost: 125</h3>
        <img src="https://images-na.ssl-images-amazon.com/images/I/41IBXh%2BJaDL._AC_.jpg">
      </div>
    </section>
    <section id="clix">
      <div class="iRow">
        <img src="https://images-na.ssl-images-amazon.com/images/I/41IBXh%2BJaDL._AC_.jpg">
        <p>Name: Batman</p>
        <p>Cost: 125</p>
        <table>
          <tr>
            <th><img src="https://wizkids.com/heroclix/wp-content/uploads/sites/2/2017/03/EXP.png" class="statImage"></th>
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td>   
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td> 
          </tr>
          <tr>
            <th><img src="https://wizkids.com/heroclix/wp-content/uploads/sites/2/2018/03/Auto.png" class="statImage"></th>
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td>   
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td> 
          </tr>
          <tr>
            <th><img src="https://vignette.wikia.nocookie.net/heroclix/images/f/f7/Standard_Defense.jpg/revision/latest?cb=20171223031500" class="statImage"></th>
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td>   
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td> 
          </tr>
          <tr>
            <th><img src="https://vignette.wikia.nocookie.net/heroclix/images/d/d1/Standard_Speed.jpg/revision/latest?cb=20171223025605" class="statImage"></th>
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td>   
            <td>KO</td>
            <td>KO</td>    
            <td>KO</td>
            <td>KO</td>  
            <td>KO</td> 
            <td>KO</td> 
          </tr>
        </table>
    </section>
  </section>
</body>
</html>